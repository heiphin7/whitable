<!DOCTYPE html>
<html lang="ru">
<head>
  <meta charset="UTF-8" />
  <meta name="viewport" content="width=device-width, initial-scale=1.0" />
  <title>Рестораны - Admin Dashboard</title>
  <script src="https://cdn.tailwindcss.com"></script>
  <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.4.0/css/all.min.css" />
</head>
<body class="flex h-screen bg-gray-100 overflow-hidden">
<!-- Sidebar -->
<aside id="sidebar" class="fixed inset-y-0 left-0 bg-gradient-to-b from-blue-600 to-indigo-700 w-64 p-6 space-y-6 text-gray-100 transform translate-x-0 transition-transform duration-300 ease-in-out z-20">
  <div class="flex items-center justify-between">
    <div class="flex items-center space-x-2">
      <i class="fas fa-utensils text-2xl"></i>
      <span class="text-2xl font-bold">Whitable</span>
    </div>
    <button id="menu-close" class="focus:outline-none">
      <i class="fas fa-times text-lg"></i>
    </button>
  </div>
  <nav class="mt-8 flex flex-col space-y-2">
    <a href="/admin/dashboard" class="flex items-center px-4 py-2 rounded-lg hover:bg-indigo-500 transition-colors">
      <i class="fas fa-tachometer-alt w-6"></i>
      <span class="ml-3">Dashboard</span>
    </a>
    <a href="/admin/users" class="flex items-center px-4 py-2 rounded-lg hover:bg-indigo-500 transition-colors">
      <i class="fas fa-users w-6"></i>
      <span class="ml-3">Пользователи</span>
    </a>
    <a href="/admin/bookings" class="flex items-center px-4 py-2 rounded-lg hover:bg-indigo-500 transition-colors">
      <i class="fas fa-calendar-check w-6"></i>
      <span class="ml-3">Бронирования</span>
    </a>
    <a href="/admin/restaurants" class="flex items-center px-4 py-2 rounded-lg bg-indigo-500 bg-opacity-20 transition-colors">
      <i class="fas fa-utensils w-6"></i>
      <span class="ml-3">Рестораны</span>
    </a>
  </nav>
</aside>

<!-- Main content -->
<div id="mainContent" class="flex-1 flex flex-col overflow-hidden transform transition-all duration-300 ease-in-out ml-64">
  <header class="relative z-30 flex items-center justify-between bg-white px-6 py-4 border-b shadow">
    <button id="menu-open" class="hidden text-gray-600 focus:outline-none">
      <i class="fas fa-bars text-xl"></i>
    </button>
    <h1 class="text-2xl font-semibold text-gray-700">Рестораны</h1>
    <div class="flex items-center space-x-4">
      <button class="relative text-gray-600 focus:outline-none hover:text-gray-800 transition">
        <i class="fas fa-bell text-xl"></i>
        <span class="absolute top-0 right-0 block h-2 w-2 rounded-full bg-red-600 animate-ping"></span>
        <span class="absolute top-0 right-0 inline-block h-2 w-2 rounded-full bg-red-600"></span>
      </button>
      <div class="flex items-center space-x-2">
        <img class="h-8 w-8 rounded-full" src="/img/user-icon.png" alt="Admin">
        <span class="font-medium text-gray-700">Admin</span>
      </div>
    </div>
  </header>

  <main class="flex-1 overflow-y-auto p-6">
    <div id="loading" class="flex items-center justify-center h-full">
      <i class="fas fa-spinner fa-spin fa-3x text-gray-500"></i>
      <span class="ml-4 text-lg text-gray-600">Пожалуйста, подождите...</span>
    </div>

    <div id="content" class="hidden">
      <!-- Статистика -->
      <div class="grid grid-cols-1 sm:grid-cols-3 gap-6 mb-6">
        <div class="bg-white rounded-lg shadow p-6 relative overflow-hidden">
          <div class="absolute top-4 right-4 bg-blue-100 p-3 rounded-full text-blue-500">
            <i class="fas fa-store"></i>
          </div>
          <p class="text-sm font-medium text-gray-500 uppercase">Ресторанов</p>
          <p id="statTotalRestaurants" class="mt-1 text-2xl font-semibold text-gray-800" th:text="${restaurantsCount}">0</p>
        </div>
        <div class="bg-white rounded-lg shadow p-6 relative overflow-hidden">
          <div class="absolute top-4 right-4 bg-yellow-100 p-3 rounded-full text-yellow-500">
            <i class="fas fa-star"></i>
          </div>
          <p class="text-sm font-medium text-gray-500 uppercase">Отзывов</p>
          <p id="statTotalReviews" class="mt-1 text-2xl font-semibold text-gray-800" th:text="${reviewsCount}">0</p>
        </div>
        <div class="bg-white rounded-lg shadow p-6 relative overflow-hidden">
          <div class="absolute top-4 right-4 bg-green-100 p-3 rounded-full text-green-500">
            <i class="fas fa-calendar-check"></i>
          </div>
          <p class="text-sm font-medium text-gray-500 uppercase">Бронирований</p>
          <p id="statTotalBookings" class="mt-1 text-2xl font-semibold text-gray-800" th:text="${bookingsCount}">0</p>
        </div>
      </div>

      <!-- Таблица ресторанов -->
      <section class="bg-white rounded-lg shadow p-6">
        <div class="flex items-center justify-between mb-4">
          <h2 class="text-lg font-semibold text-gray-700">Список ресторанов</h2>
          <button
                  id="addRestaurantBtn"
                  class="flex items-center space-x-2 bg-blue-600 hover:bg-blue-700 text-white font-medium px-4 py-2 rounded transition"
                  type="button"
          >
            <i class="fas fa-plus"></i>
            <span>Создание ресторана</span>
          </button>
        </div>

        <div class="overflow-x-auto">
          <table class="min-w-full divide-y divide-gray-200">
            <thead class="bg-gray-50">
            <tr>
              <th class="px-6 py-3 text-left text-xs font-medium text-gray-500 uppercase">ID</th>
              <th class="px-6 py-3 text-left text-xs font-medium text-gray-500 uppercase">Название</th>
              <th class="px-6 py-3 text-left text-xs font-medium text-gray-500 uppercase">Описание</th>
              <th class="px-6 py-3 text-left text-xs font-medium text-gray-500 uppercase">Адрес</th>
              <th class="px-6 py-3 text-left text-xs font-medium text-gray-500 uppercase">Телефон</th>
              <th class="px-6 py-3 text-left text-xs font-medium text-gray-500 uppercase">Рейтинг</th>
              <th class="px-6 py-3 text-left text-xs font-medium text-gray-500 uppercase">Отзывы</th>
              <th class="px-6 py-3 text-left text-xs font-medium text-gray-500 uppercase">Кухня</th>
              <th class="px-6 py-3 text-left text-xs font-medium text-gray-500 uppercase">URL</th>
              <th class="px-6 py-3 text-left text-xs font-medium text-gray-500 uppercase">Actions</th>
            </tr>
            </thead>
            <tbody id="restaurantTable" class="bg-white divide-y divide-gray-200"></tbody>
          </table>
        </div>
      </section>
    </div>
  </main>
</div>

<!-- Модалка изменения ресторана -->
<div id="editModal" class="fixed inset-0 hidden flex items-center justify-center bg-black bg-opacity-50">
  <div class="bg-white rounded-lg shadow-lg w-1/3 p-6">
    <h3 class="text-xl font-semibold mb-4">Изменить ресторан</h3>
    <form id="editForm" class="space-y-4">
      <input type="hidden" id="editRestaurantId" />
      <div>
        <label class="block text-sm font-medium text-gray-700">Название</label>
        <input id="editName" type="text" class="mt-1 block w-full border-gray-300 rounded-md shadow-sm" />
      </div>
      <div>
        <label class="block text-sm font-medium text-gray-700">Описание</label>
        <input id="editDescription" type="text" class="mt-1 block w-full border-gray-300 rounded-md shadow-sm" />
      </div>
      <div>
        <label class="block text-sm font-medium text-gray-700">Адрес</label>
        <input id="editAddress" type="text" class="mt-1 block w-full border-gray-300 rounded-md shadow-sm" />
      </div>
      <div>
        <label class="block text-sm font-medium text-gray-700">Телефон</label>
        <input id="editPhone" type="text" class="mt-1 block w-full border-gray-300 rounded-md shadow-sm" />
      </div>
      <div>
        <label class="block text-sm font-medium text-gray-700">Кухня</label>
        <select id="editCuisine" class="mt-1 block w-full border-gray-300 rounded-md shadow-sm">
          <option>Итальянская</option>
          <option>Китайская</option>
          <option>Французская</option>
          <option>Японская</option>
          <option>Мексиканская</option>
          <option>Американская</option>
          <option>Мультинациональная</option>
          <option>Казахская</option>
          <option>Европейская</option>
          <option>Стейкхаус</option>
        </select>
      </div>
      <div>
        <label class="block text-sm font-medium text-gray-700">URL</label>
        <input id="editUrl" type="text" class="mt-1 block w-full border-gray-300 rounded-md shadow-sm" />
      </div>
      <div class="flex justify-end space-x-2">
        <button type="button" id="cancelBtn" class="px-4 py-2 bg-gray-200 rounded-lg hover:bg-gray-300">Отмена</button>
        <button type="submit" class="px-4 py-2 bg-indigo-600 text-white rounded-lg hover:bg-indigo-700">Сохранить</button>
      </div>
    </form>
  </div>
</div>

<!-- Модальное окно (по умолчанию скрыто) -->
<div
        id="createRestaurantModal"
        class="hidden fixed inset-0 bg-gray-900 bg-opacity-50 overflow-y-auto p-4 flex items-start justify-center z-50"
>

  <!-- Вложенный контейнер для формы -->
  <div class="bg-white rounded-lg shadow-lg w-full max-w-4xl max-h-[80vh] overflow-y-auto p-6 relative">
    <!-- Кнопка закрытия -->
    <button
            id="closeModalBtn"
            type="button"
            class="absolute top-4 right-4 text-gray-600 hover:text-gray-800 text-xl font-bold"
    >
      &times;
    </button>

    <h2 class="text-2xl font-bold mb-6 pb-4 border-b">Создание нового ресторана</h2>

    <!-- Форма для создания ресторана -->
    <form
            id="createRestaurantForm"
            th:action="@{/restaurant/create}"
            method="post"
            enctype="multipart/form-data"
            class="space-y-4"
    >
      <!-- 1) Основные поля -->
      <div>
        <label class="block mb-1 font-semibold text-gray-600">Name</label>
        <input
                type="text"
                name="name"
                class="w-full border border-gray-300 rounded px-3 py-2 focus:outline-none focus:border-blue-500"
                required
        />
      </div>

      <div>
        <label class="block mb-1 font-semibold text-gray-600">Description</label>
        <textarea
                name="description"
                rows="3"
                class="w-full border border-gray-300 rounded px-3 py-2 focus:outline-none focus:border-blue-500"
        ></textarea>
      </div>

      <div>
        <label class="block mb-1 font-semibold text-gray-600">Часы работы ресторана</label>
        <!-- Контейнер для динамического добавления дней -->
        <div class="opening-hours grid grid-cols-1 gap-4">
          <!-- Понедельник -->
          <div class="flex flex-wrap items-center gap-4">
            <label for="mondayStart" class="w-32 font-medium text-gray-700">Понедельник:</label>

            <span class="text-gray-600">ОТ</span>
            <select id="mondayStart" name="openingHours[Monday][start]" class="w-32 px-2 py-1 border rounded-md" required>
              <option value="">Выберите...</option>
              <option value="00:00">00:00</option>
              <option value="01:00">01:00</option>
              <option value="02:00">02:00</option>
              <option value="03:00">03:00</option>
              <option value="04:00">04:00</option>
              <option value="05:00">05:00</option>
              <option value="06:00">06:00</option>
              <option value="07:00">07:00</option>
              <option value="08:00">08:00</option>
              <option value="09:00">09:00</option>
              <option value="10:00">10:00</option>
              <option value="11:00">11:00</option>
            </select>

            <span class="text-gray-600">до</span>
            <select id="mondayEnd" name="openingHours[Monday][end]" class="w-32 px-2 py-1 border rounded-md" required>
              <option value="">Выберите...</option>
              <option value="00:00">00:00</option>
              <option value="01:00">01:00</option>
              <option value="02:00">02:00</option>
              <option value="03:00">03:00</option>
              <option value="04:00">04:00</option>
              <option value="05:00">05:00</option>
              <option value="06:00">06:00</option>
              <option value="07:00">07:00</option>
              <option value="08:00">08:00</option>
              <option value="09:00">09:00</option>
              <option value="10:00">10:00</option>
              <option value="11:00">11:00</option>
            </select>

            <!-- Closed checkbox -->
            <label class="flex items-center gap-2 text-red-600 font-medium">
              <input type="checkbox" id="mondayClosed" name="openingHours[Monday][closed]" value="true">
              Закрыто
            </label>
          </div>

          <!-- Вторник -->
          <div class="flex flex-wrap items-center gap-4">
            <label for="tuesdayStart" class="w-32 font-medium text-gray-700">Вторник:</label>
            <span class="text-gray-600">От</span>
            <select id="tuesdayStart" name="openingHours[Tuesday][start]" required class="w-32 px-2 py-1 border border-gray-300 rounded-md">
              <option value="">Выберите...</option>
              <option value="00:00">00:00</option>
              <option value="01:00">01:00</option>
              <option value="02:00">02:00</option>
              <option value="03:00">03:00</option>
              <option value="04:00">04:00</option>
              <option value="05:00">05:00</option>
              <option value="06:00">06:00</option>
              <option value="07:00">07:00</option>
              <option value="08:00">08:00</option>
              <option value="09:00">09:00</option>
              <option value="10:00">10:00</option>
              <option value="11:00">11:00</option>
            </select>
            <span class="text-gray-600">до</span>
            <select id="tuesdayEnd" name="openingHours[Tuesday][end]" required class="w-32 px-2 py-1 border border-gray-300 rounded-md">
              <option value="">Выберите...</option>
              <option value="00:00">00:00</option>
              <option value="01:00">01:00</option>
              <option value="02:00">02:00</option>
              <option value="03:00">03:00</option>
              <option value="04:00">04:00</option>
              <option value="05:00">05:00</option>
              <option value="06:00">06:00</option>
              <option value="07:00">07:00</option>
              <option value="08:00">08:00</option>
              <option value="09:00">09:00</option>
              <option value="10:00">10:00</option>
              <option value="11:00">11:00</option>
            </select>

            <label class="flex items-center gap-2 text-red-600 font-medium">
              <input type="checkbox" id="tuesdayClosed" name="openingHours[Tuesday][closed]" value="true">
              Закрыто
            </label>
          </div>

          <!-- Среда -->
          <div class="flex flex-wrap items-center gap-4">
            <label for="wednesdayStart" class="w-32 font-medium text-gray-700">Среда:</label>
            <span class="text-gray-600">От</span>
            <select id="wednesdayStart" name="openingHours[Wednesday][start]" required class="w-32 px-2 py-1 border border-gray-300 rounded-md">
              <option value="">Выберите...</option>
              <option value="00:00">00:00</option>
              <option value="01:00">01:00</option>
              <option value="02:00">02:00</option>
              <option value="03:00">03:00</option>
              <option value="04:00">04:00</option>
              <option value="05:00">05:00</option>
              <option value="06:00">06:00</option>
              <option value="07:00">07:00</option>
              <option value="08:00">08:00</option>
              <option value="09:00">09:00</option>
              <option value="10:00">10:00</option>
              <option value="11:00">11:00</option>
            </select>
            <span class="text-gray-600">до</span>
            <select id="wednesdayEnd" name="openingHours[Wednesday][end]" required class="w-32 px-2 py-1 border border-gray-300 rounded-md">
              <option value="">Выберите...</option>
              <option value="00:00">00:00</option>
              <option value="01:00">01:00</option>
              <option value="02:00">02:00</option>
              <option value="03:00">03:00</option>
              <option value="04:00">04:00</option>
              <option value="05:00">05:00</option>
              <option value="06:00">06:00</option>
              <option value="07:00">07:00</option>
              <option value="08:00">08:00</option>
              <option value="09:00">09:00</option>
              <option value="10:00">10:00</option>
              <option value="11:00">11:00</option>
            </select>

            <label class="flex items-center gap-2 text-red-600 font-medium">
              <input type="checkbox" id="wednesdayClosed" name="openingHours[Wednesday][closed]" value="true">
              Закрыто
            </label>
          </div>

          <!-- Четверг -->
          <div class="flex flex-wrap items-center gap-4">
            <label for="thursdayStart" class="w-32 font-medium text-gray-700">Четверг:</label>
            <span class="text-gray-600">От</span>
            <select id="thursdayStart" name="openingHours[Thursday][start]" required class="w-32 px-2 py-1 border border-gray-300 rounded-md">
              <option value="">Выберите...</option>
              <option value="00:00">00:00</option>
              <option value="01:00">01:00</option>
              <option value="02:00">02:00</option>
              <option value="03:00">03:00</option>
              <option value="04:00">04:00</option>
              <option value="05:00">05:00</option>
              <option value="06:00">06:00</option>
              <option value="07:00">07:00</option>
              <option value="08:00">08:00</option>
              <option value="09:00">09:00</option>
              <option value="10:00">10:00</option>
              <option value="11:00">11:00</option>
            </select>
            <span class="text-gray-600">до</span>
            <select id="thursdayEnd" name="openingHours[Thursday][end]" required class="w-32 px-2 py-1 border border-gray-300 rounded-md">
              <option value="">Выберите...</option>
              <option value="00:00">00:00</option>
              <option value="01:00">01:00</option>
              <option value="02:00">02:00</option>
              <option value="03:00">03:00</option>
              <option value="04:00">04:00</option>
              <option value="05:00">05:00</option>
              <option value="06:00">06:00</option>
              <option value="07:00">07:00</option>
              <option value="08:00">08:00</option>
              <option value="09:00">09:00</option>
              <option value="10:00">10:00</option>
              <option value="11:00">11:00</option>
            </select>

            <label class="flex items-center gap-2 text-red-600 font-medium">
              <input type="checkbox" id="thursdayClosed" name="openingHours[Thursday][closed]" value="true">
              Закрыто
            </label>
          </div>

          <!-- Пятница -->
          <div class="flex flex-wrap items-center gap-4">
            <label for="fridayStart" class="w-32 font-medium text-gray-700">Пятница:</label>
            <span class="text-gray-600">От</span>
            <select id="fridayStart" name="openingHours[Friday][start]" required class="w-32 px-2 py-1 border border-gray-300 rounded-md">
              <option value="">Выберите...</option>
              <option value="00:00">00:00</option>
              <option value="01:00">01:00</option>
              <option value="02:00">02:00</option>
              <option value="03:00">03:00</option>
              <option value="04:00">04:00</option>
              <option value="05:00">05:00</option>
              <option value="06:00">06:00</option>
              <option value="07:00">07:00</option>
              <option value="08:00">08:00</option>
              <option value="09:00">09:00</option>
              <option value="10:00">10:00</option>
              <option value="11:00">11:00</option>
            </select>
            <span class="text-gray-600">до</span>
            <select id="fridayEnd" name="openingHours[Friday][end]" required class="w-32 px-2 py-1 border border-gray-300 rounded-md">
              <option value="">Выберите...</option>
              <option value="00:00">00:00</option>
              <option value="01:00">01:00</option>
              <option value="02:00">02:00</option>
              <option value="03:00">03:00</option>
              <option value="04:00">04:00</option>
              <option value="05:00">05:00</option>
              <option value="06:00">06:00</option>
              <option value="07:00">07:00</option>
              <option value="08:00">08:00</option>
              <option value="09:00">09:00</option>
              <option value="10:00">10:00</option>
              <option value="11:00">11:00</option>
            </select>

            <label class="flex items-center gap-2 text-red-600 font-medium">
              <input type="checkbox" id="fridayClosed" name="openingHours[Friday][closed]" value="true">
              Закрыто
            </label>
          </div>

          <!-- Суббота -->
          <div class="flex flex-wrap items-center gap-4">
            <label for="saturdayStart" class="w-32 font-medium text-gray-700">Суббота:</label>
            <span class="text-gray-600">От</span>
            <select id="saturdayStart" name="openingHours[Saturday][start]" required class="w-32 px-2 py-1 border border-gray-300 rounded-md">
              <option value="">Выберите...</option>
              <option value="00:00">00:00</option>
              <option value="01:00">01:00</option>
              <option value="02:00">02:00</option>
              <option value="03:00">03:00</option>
              <option value="04:00">04:00</option>
              <option value="05:00">05:00</option>
              <option value="06:00">06:00</option>
              <option value="07:00">07:00</option>
              <option value="08:00">08:00</option>
              <option value="09:00">09:00</option>
              <option value="10:00">10:00</option>
              <option value="11:00">11:00</option>
            </select>
            <span class="text-gray-600">до</span>
            <select id="saturdayEnd" name="openingHours[Saturday][end]" required class="w-32 px-2 py-1 border border-gray-300 rounded-md">
              <option value="">Выберите...</option>
              <option value="00:00">00:00</option>
              <option value="01:00">01:00</option>
              <option value="02:00">02:00</option>
              <option value="03:00">03:00</option>
              <option value="04:00">04:00</option>
              <option value="05:00">05:00</option>
              <option value="06:00">06:00</option>
              <option value="07:00">07:00</option>
              <option value="08:00">08:00</option>
              <option value="09:00">09:00</option>
              <option value="10:00">10:00</option>
              <option value="11:00">11:00</option>
            </select>

            <label class="flex items-center gap-2 text-red-600 font-medium">
              <input type="checkbox" id="saturdayClosed" name="openingHours[Saturday][closed]" value="true">
              Закрыто
            </label>
          </div>

          <!-- Воскресенье -->
          <div class="flex flex-wrap items-center gap-4">
            <label for="sundayStart" class="w-32 font-medium text-gray-700">Воскресенье:</label>
            <span class="text-gray-600">От</span>
            <select id="sundayStart" name="openingHours[Sunday][start]" required class="w-32 px-2 py-1 border border-gray-300 rounded-md">
              <option value="">Выберите...</option>
              <option value="00:00">00:00</option>
              <option value="01:00">01:00</option>
              <option value="02:00">02:00</option>
              <option value="03:00">03:00</option>
              <option value="04:00">04:00</option>
              <option value="05:00">05:00</option>
              <option value="06:00">06:00</option>
              <option value="07:00">07:00</option>
              <option value="08:00">08:00</option>
              <option value="09:00">09:00</option>
              <option value="10:00">10:00</option>
              <option value="11:00">11:00</option>
            </select>
            <span class="text-gray-600">до</span>
            <select id="sundayEnd" name="openingHours[Sunday][end]" required class="w-32 px-2 py-1 border border-gray-300 rounded-md">
              <option value="">Выберите...</option>
              <option value="00:00">00:00</option>
              <option value="01:00">01:00</option>
              <option value="02:00">02:00</option>
              <option value="03:00">03:00</option>
              <option value="04:00">04:00</option>
              <option value="05:00">05:00</option>
              <option value="06:00">06:00</option>
              <option value="07:00">07:00</option>
              <option value="08:00">08:00</option>
              <option value="09:00">09:00</option>
              <option value="10:00">10:00</option>
              <option value="11:00">11:00</option>
            </select>

            <label class="flex items-center gap-2 text-red-600 font-medium">
              <input type="checkbox" id="sundayClosed" name="openingHours[Sunday][closed]" value="true">
              Закрыто
            </label>
          </div>
        </div>

        <p id="hoursError" class="text-red-600 font-semibold text-base mt-4 mb-2 hidden">
          Ресторан должен работать хотя бы в один день.
        </p>

      </div>

      <div>
        <label class="block mb-1 font-semibold text-gray-600">Address</label>
        <input
                type="text"
                name="address"
                class="w-full border border-gray-300 rounded px-3 py-2 focus:outline-none focus:border-blue-500"
        />
      </div>

      <div>
        <label class="block mb-1 font-semibold text-gray-600">Phone Number</label>
        <input
                type="text"
                name="phoneNumber"
                class="w-full border border-gray-300 rounded px-3 py-2 focus:outline-none focus:border-blue-500"
        />
      </div>

      <div>
        <label class="block mb-1 font-semibold text-gray-600">Average Check</label>
        <input
                type="number"
                name="averageCheck"
                class="w-full border border-gray-300 rounded px-3 py-2 focus:outline-none focus:border-blue-500"
        />
      </div>

      <div>
        <label class="block mb-1 font-semibold text-gray-600">Capacity For Hour</label>
        <input
                type="number"
                name="capacityForHour"
                class="w-full border border-gray-300 rounded px-3 py-2 focus:outline-none focus:border-blue-500"
                required
        />
      </div>

      <div>
        <label class="block mb-1 font-semibold text-gray-600">URL to Restaurant</label>
        <input
                type="text"
                name="urlToRestaurant"
                placeholder="https://..."
                class="w-full border border-gray-300 rounded px-3 py-2 focus:outline-none focus:border-blue-500"
        />
      </div>

      <div>
        <label class="block mb-1 font-semibold text-gray-600">Upload Photo</label>
        <input
                type="file"
                name="file"
                accept="image/*"
                class="w-full"
        />
      </div>

      <!-- 2) Выбор удобств (facilities) с помощью чекбоксов -->
      <div>
        <label class="block mb-1 font-semibold text-gray-600">Facilities</label>
        <div class="flex flex-wrap gap-4 mt-2">
          <label class="flex items-center">
            <input type="checkbox" name="facilities" value="Уличные сиденья" class="mr-2" />
            Уличные сиденья
          </label>
          <label class="flex items-center">
            <input type="checkbox" name="facilities" value="Парковка" class="mr-2" />
            Парковка
          </label>
          <label class="flex items-center">
            <input type="checkbox" name="facilities" value="Wi-Fi" class="mr-2" />
            Wi-Fi
          </label>
          <label class="flex items-center">
            <input type="checkbox" name="facilities" value="Доставка" class="mr-2" />
            Доставка
          </label>
          <label class="flex items-center">
            <input type="checkbox" name="facilities" value="Самовывоз" class="mr-2" />
            Самовывоз
          </label>
        </div>
      </div>

      <!-- 3) Выбор типов кухонь (cuisineTypes) с помощью чекбоксов -->
      <div>
        <label class="block mb-1 font-semibold text-gray-600">Cuisine Type</label>
        <div class="flex flex-wrap gap-4 mt-2">
          <label class="flex items-center">
            <input type="radio" name="cuisineType" value="Итальянская" class="mr-2" required />
            Итальянская
          </label>
          <label class="flex items-center">
            <input type="radio" name="cuisineType" value="Китайская" class="mr-2" />
            Китайская
          </label>
          <label class="flex items-center">
            <input type="radio" name="cuisineType" value="Французская" class="mr-2" />
            Французская
          </label>
          <label class="flex items-center">
            <input type="radio" name="cuisineType" value="Японская" class="mr-2" />
            Японская
          </label>
          <label class="flex items-center">
            <input type="radio" name="cuisineType" value="Мексиканская" class="mr-2" />
            Мексиканская
          </label>
          <label class="flex items-center">
            <input type="radio" name="cuisineType" value="Американская" class="mr-2" />
            Американская
          </label>
          <label class="flex items-center">
            <input type="radio" name="cuisineType" value="Мультинациональная" class="mr-2" />
            Мультинациональная
          </label>
          <label class="flex items-center">
            <input type="radio" name="cuisineType" value="Казахская" class="mr-2" />
            Казахская
          </label>
          <label class="flex items-center">
            <input type="radio" name="cuisineType" value="Европейская" class="mr-2" />
            Европейская
          </label>
          <label class="flex items-center">
            <input type="radio" name="cuisineType" value="Стейкхаус" class="mr-2" />
            Стейкхаус
          </label>
        </div>
      </div>

      <!-- 4) Кнопки отправки и отмены -->
      <div class="flex justify-end space-x-3">
        <button
                type="button"
                id="cancelModalBtn"
                class="px-4 py-2 rounded border border-gray-400 text-gray-600 hover:bg-gray-100"
        >
          Cancel
        </button>
        <button
                type="submit"
                class="px-4 py-2 rounded bg-blue-600 text-white hover:bg-blue-700 font-semibold"
        >
          Create
        </button>
      </div>
    </form>
  </div>
</div>

<script th:inline="javascript" defer>
  // Вынесем всё в функцию, чтобы можно было вызывать повторно после сохранения
  async function loadRestaurants() {
    const loading = document.getElementById('loading');
    const content = document.getElementById('content');
    const statTotal = document.getElementById('statTotalRestaurants');
    const statReviews = document.getElementById('statTotalReviews');
    const statBookings = document.getElementById('statTotalBookings');
    const tbody = document.getElementById('restaurantTable');
    let restaurantsCache = [];

    // 1) показываем спиннер, прячем контент
    loading.classList.remove('hidden');
    content.classList.add('hidden');

    try {
      // 2) запрашиваем данные
      const res = await fetch('/api/restaurants', { credentials: 'include' });
      if (!res.ok) throw new Error(res.statusText);
      restaurantsCache = await res.json();

      // 3) скрываем спиннер, показываем контент
      loading.classList.add('hidden');
      content.classList.remove('hidden');

      // 4) обновляем статистику
      statTotal.textContent   = restaurantsCache.length;
      statReviews.textContent = restaurantsCache.reduce((sum, r) => sum + (r.reviewCount || 0), 0);
      statBookings.textContent= restaurantsCache.reduce((sum, r) => sum + (r.bookingCount || 0), 0);

      // 5) строим таблицу
      tbody.innerHTML = '';
      for (const r of restaurantsCache) {
        const tr = document.createElement('tr');
        tr.className = 'hover:bg-gray-50 transition-colors';
        tr.innerHTML = `
          <td class="px-6 py-4 text-gray-700">${r.id}</td>
          <td class="px-6 py-4 text-gray-700">${r.name}</td>
          <td class="px-6 py-4 text-gray-700">${r.description}</td>
          <td class="px-6 py-4 text-gray-700">${r.address}</td>
          <td class="px-6 py-4 text-gray-700">${r.phoneNumber}</td>
          <td class="px-6 py-4 text-gray-700">${r.rating > 0 ? r.rating.toFixed(1) : 'N/A'}</td>
          <td class="px-6 py-4 text-gray-700">${r.reviewCount > 0 ? r.reviewCount : 'N/A'}</td>
          <td class="px-6 py-4 text-gray-700">${r.cuisineType}</td>
          <td class="px-6 py-4 text-gray-700">
            ${r.url ? `<a href="${r.url}" target="_blank" class="text-blue-600 underline">Ссылка</a>` : 'N/A'}
          </td>
          <td class="px-6 py-4 text-gray-700">
            <button data-id="${r.id}" class="edit-btn text-indigo-600 hover:text-indigo-900">
              <i class="fas fa-edit"></i>
            </button>
          </td>
        `;
        tbody.appendChild(tr);
      }

      // прикручиваем открытие модалки к кнопкам «edit»
      document.getElementById('restaurantTable').addEventListener('click', e => {
        const btn = e.target.closest('.edit-btn');
        if (!btn) return;
        const id = +btn.dataset.id;
        const r = restaurantsCache.find(x => x.id === id);
        document.getElementById('editRestaurantId').value = r.id;
        document.getElementById('editName').value = r.name;
        document.getElementById('editDescription').value = r.description;
        document.getElementById('editAddress').value = r.address;
        document.getElementById('editPhone').value = r.phoneNumber;
        document.getElementById('editCuisine').value = r.cuisineType;
        document.getElementById('editUrl').value = r.url;
        document.getElementById('editModal').classList.remove('hidden');
      });
    } catch (err) {
      loading.innerHTML = `<span class="text-red-600">Ошибка загрузки: ${err.message}</span>`;
    }
  }

  document.addEventListener('DOMContentLoaded', () => {
    // сначала грузим рестораны
    loadRestaurants();

    // сайдбар
    const sidebar = document.getElementById('sidebar');
    const btnOpen = document.getElementById('menu-open');
    const btnClose= document.getElementById('menu-close');
    btnOpen?.addEventListener('click', () => {
      sidebar.classList.replace('-translate-x-full','translate-x-0');
      btnOpen.classList.add('hidden'); btnClose.classList.remove('hidden');
      document.getElementById('mainContent').classList.add('ml-64');
    });
    btnClose?.addEventListener('click', () => {
      sidebar.classList.replace('translate-x-0','-translate-x-full');
      btnClose.classList.add('hidden'); btnOpen.classList.remove('hidden');
      document.getElementById('mainContent').classList.remove('ml-64');
    });

    // отмена модалки
    document.getElementById('cancelBtn').addEventListener('click', () => {
      document.getElementById('editModal').classList.add('hidden');
    });

    // отправка изменений
    document.getElementById('editForm').addEventListener('submit', async e => {
      e.preventDefault();
      const saveBtn = e.target.querySelector('button[type="submit"]');
      saveBtn.disabled = true;

      // Собираем DTO из полей
      const id = +document.getElementById('editRestaurantId').value;
      const dto = {
        id,
        name:         document.getElementById('editName').value.trim(),
        description:  document.getElementById('editDescription').value.trim(),
        address:      document.getElementById('editAddress').value.trim(),
        phoneNumber:  document.getElementById('editPhone').value.trim(),
        cuisineType:  document.getElementById('editCuisine').value,
        url:          document.getElementById('editUrl').value.trim()
      };

      try {
        const res = await fetch(`/api/restaurants/${id}`, {
          method:      'PUT',
          credentials: 'include',
          headers:     { 'Content-Type': 'application/json' },
          body:        JSON.stringify(dto)
        });

        if (res.status === 400) {
          // на 400 сервер вернёт plain text (сообщение об ошибке)
          const errText = await res.text();
          alert(errText);
        } else if (!res.ok) {
          // все прочие ошибки
          throw new Error(res.statusText);
        } else {
          // успех
          document.getElementById('editModal').classList.add('hidden');
          await loadRestaurants();  // перезагружаем список
        }
      } catch (err) {
        alert('Ошибка: ' + err.message);
      } finally {
        saveBtn.disabled = false;
      }
    });
  });

  var isAdmin = '[(${isAdmin})]'; // Например: 'true' или 'false'
  isAdmin = (isAdmin === 'true');

  document.addEventListener('DOMContentLoaded', () => {
    const form = document.getElementById('createRestaurantForm'); // или другой способ получения формы
    if (!form) {
      console.error("Форма создания ресторана не найдена");
      return;
    }

    const addHoursBtn = document.getElementById('addHoursBtn');
    const openingHoursContainer = document.getElementById('openingHoursContainer');
    const daySelector = document.getElementById('daySelector');
    const timeInput = document.getElementById('timeInput');

    // Храним day/time в Map, где ключ — это день, значение — интервал
    const openingHours = new Map();

    // При клике на "Add" сохраняем в Map и обновляем отображение
    addHoursBtn.addEventListener('click', () => {
      const day = daySelector.value.trim();
      const time = timeInput.value.trim();

      if (!day || !time) {
        alert('Пожалуйста, выберите день и введите часы работы.');
        return;
      }

      // Добавляем или перезаписываем в Map
      openingHours.set(day, time);

      // Очищаем поле ввода
      timeInput.value = '';

      // Обновляем список в контейнере и скрытые поля
      updateOpeningHours();
    });

    // Основная функция для обновления и контейнера, и скрытых input'ов
    function updateOpeningHours() {
      // 1) Удаляем старые скрытые поля из формы
      form.querySelectorAll('input[name^="openingHours["]').forEach(elem => elem.remove());

      // 2) Очищаем визуальный контейнер
      openingHoursContainer.innerHTML = '';

      // 3) Проходимся по Map и для каждого дня/интервала:
      openingHours.forEach((time, day) => {
        // a) Создаём скрытый инпут, который пойдёт на сервер
        const hiddenInput = document.createElement('input');
        hiddenInput.type = 'hidden';
        hiddenInput.name = `openingHours[${day}]`;
        hiddenInput.value = time;
        form.appendChild(hiddenInput);

        // b) Создаём блок для наглядного отображения
        const entryDiv = document.createElement('div');
        entryDiv.classList.add('flex', 'items-center', 'justify-between', 'bg-gray-100', 'p-2', 'rounded');

        // c) Текст: "Понедельник: 10:00 - 18:00"
        const dayTimeText = document.createElement('span');
        dayTimeText.textContent = `${day}: ${time}`;
        entryDiv.appendChild(dayTimeText);

        // d) Кнопка для удаления записи
        const removeBtn = document.createElement('button');
        removeBtn.textContent = 'Удалить';
        removeBtn.classList.add('bg-red-500', 'text-white', 'px-2', 'py-1', 'rounded');
        removeBtn.addEventListener('click', () => {
          // Удаляем запись из Map
          openingHours.delete(day);
          // Обновляем контейнер и поля формы
          updateOpeningHours();
        });
        entryDiv.appendChild(removeBtn);

        // e) Добавляем весь блок в контейнер
        openingHoursContainer.appendChild(entryDiv);
      });
    }

    // Перед отправкой формы ещё раз актуализируем скрытые поля
    form.addEventListener('submit', () => {
      updateOpeningHours();
    });
  });


  // ---------- Modal Logic for "Create Restaurant" ----------

  // Получаем элементы
  const addRestaurantBtn = document.getElementById("addRestaurantBtn");
  const createRestaurantModal = document.getElementById("createRestaurantModal");
  const closeModalBtn = document.getElementById("closeModalBtn");
  const cancelModalBtn = document.getElementById("cancelModalBtn");
  const header = document.querySelector(".header"); // Находим header

  // Функция для открытия модалки
  function openModal() {
    createRestaurantModal.classList.remove("hidden");
    document.body.classList.add("body-modal-open");
    if (header) header.style.zIndex = "0"; // Ставим z-index для header
  }

  // Функция для закрытия модалки
  function closeModal() {
    createRestaurantModal.classList.add("hidden");
    document.body.classList.remove("body-modal-open");
    if (header) header.style.zIndex = "500"; // Возвращаем z-index для header
  }

  // Открыть модалку по кнопке "+"
  if (addRestaurantBtn) {
    addRestaurantBtn.addEventListener("click", openModal);
  }

  // Закрыть по кнопке "×"
  if (closeModalBtn) {
    closeModalBtn.addEventListener("click", closeModal);
  }

  // Закрыть по кнопке "Cancel"
  if (cancelModalBtn) {
    cancelModalBtn.addEventListener("click", closeModal);
  }

  /*
   Новый метод получения иконки для фич (на русском).
   Меняем названия под ваши реальные нужды:
   'Парковка', 'Wi-Fi', 'Доставка', 'Самовывоз' и т.д.
 */
  function getFeatureIcon(feature) {
    const icons = {
      'Парковка': '<i class="fas fa-parking"></i>',
      'Wi-Fi': '<i class="fas fa-wifi"></i>',
      'Доставка': '<i class="fas fa-motorcycle"></i>',
      'Самовывоз': '<i class="fas fa-shopping-bag"></i>'
    };
    return icons[feature] || '';
  }

  document.addEventListener('DOMContentLoaded', () => {
    const featureTags = document.querySelectorAll('.feature-tag');
    featureTags.forEach(tag => {
      const featureText = tag.innerText.trim();
      const iconHtml = getFeatureIcon(featureText);
      // подменяем содержимое на "иконка + пробел + название"
      tag.innerHTML = iconHtml + ' ' + featureText;
    });
  });

  const days = ["Monday", "Tuesday", "Wednesday", "Thursday", "Friday", "Saturday", "Sunday"];
  const errorEl = document.getElementById("hoursError");

  // Функция проверяет, что все дни отмечены как "Закрыто"
  function validateAtLeastOneOpenDay() {
    // Если для каждого дня чекбокс "Закрыто" отмечен, считаем, что нет открытых дней
    const allClosed = days.every(day => {
      const closed = document.getElementById(`${day.toLowerCase()}Closed`);
      return closed && closed.checked;
    });

    if (allClosed) {
      errorEl.classList.remove("hidden");
      return false;
    } else {
      errorEl.classList.add("hidden");
      return true;
    }
  }

  // Навешиваем обработчики на каждый чекбокс и селекты для обновления состояния
  days.forEach(day => {
    const dayLower = day.toLowerCase();
    const closedCheckbox = document.getElementById(`${dayLower}Closed`);
    const startSelect = document.getElementById(`${dayLower}Start`);
    const endSelect = document.getElementById(`${dayLower}End`);

    if (!closedCheckbox || !startSelect || !endSelect) return;

    // При изменении чекбокса
    closedCheckbox.addEventListener("change", () => {
      const isClosed = closedCheckbox.checked;
      startSelect.disabled = isClosed;
      endSelect.disabled = isClosed;

      // При активации "Закрыто" очищаем время и добавляем визуальное оформление
      if (isClosed) {
        startSelect.value = "";
        endSelect.value = "";
        startSelect.classList.add("bg-gray-100", "text-gray-500");
        endSelect.classList.add("bg-gray-100", "text-gray-500");
      } else {
        startSelect.classList.remove("bg-gray-100", "text-gray-500");
        endSelect.classList.remove("bg-gray-100", "text-gray-500");
      }
      validateAtLeastOneOpenDay();
    });

    // При изменении селектов – обновляем валидацию
    startSelect.addEventListener("change", validateAtLeastOneOpenDay);
    endSelect.addEventListener("change", validateAtLeastOneOpenDay);
  });

  // Проверка при отправке формы
  document.getElementById("createRestaurantForm").addEventListener("submit", (e) => {
    const isValid = validateAtLeastOneOpenDay();
    if (!isValid) {
      e.preventDefault(); // Блокируем отправку формы, если ошибка присутствует
    }
  });

  // 1) Функция для генерации массива меток времени с шагом 30 минут
  function generateTimeLabels(intervalMinutes = 60) {
    const labels = [];
    for (let h = 0; h < 24; h++) {
      const hh = String(h).padStart(2, '0');
      labels.push(`${hh}:00`);
    }
    return labels;
  }

  // 2) Заполняем каждый select[ id$="Start" ] и select[ id$="End" ]
  function populateTimeSelects() {
    const labels = generateTimeLabels(60);
    const allSelects = document.querySelectorAll('select[id$="Start"], select[id$="End"]');

    allSelects.forEach(sel => {
      // сначала очищаем (оставляем placeholder)
      sel.innerHTML = '<option value="">Выберите...</option>';
      // затем дополняем
      labels.forEach(time => {
        const opt = document.createElement('option');
        opt.value = time;
        opt.textContent = time;
        sel.appendChild(opt);
      });
    });
  }

  // 3) Валидация: для каждого дня, если не закрыт, проверяем start < end
  function validateTimeRanges() {
    const days = ["monday","tuesday","wednesday","thursday","friday","saturday","sunday"];
    let allGood = true;

    days.forEach(day => {
      const closed = document.getElementById(`${day}Closed`)?.checked;
      if (closed) return; // если закрыт — не проверяем
      const start = document.getElementById(`${day}Start`)?.value;
      const end   = document.getElementById(`${day}End`)?.value;
      if (start && end && start >= end) {
        allGood = false;
        // можно здесь показывать inline-ошибку рядом с селектами:
        document.getElementById('hoursError').textContent =
                `В ${day[0].toUpperCase() + day.slice(1)} время начала должно быть раньше времени окончания.`;
        document.getElementById('hoursError').classList.remove('hidden');
      }
    });

    if (!allGood) {
      // если нужно — скроллим к ошибке
      document.getElementById('hoursError').scrollIntoView({ behavior: 'smooth' });
    } else {
      document.getElementById('hoursError').classList.add('hidden');
    }

    return allGood;
  }

  document.addEventListener('DOMContentLoaded', () => {
    // а) генерируем опции
    populateTimeSelects();

    // б) навешиваем финальную проверку на сабмит формы
    const form = document.getElementById('createRestaurantForm');
    form.addEventListener('submit', e => {
      // проверяем минимум один открытый день
      const atLeastOne = validateAtLeastOneOpenDay();
      // проверяем для каждого дня start < end
      const rangesOk    = validateTimeRanges();
      if (!atLeastOne || !rangesOk) {
        e.preventDefault();
      }
    });

    // в) по-умолчанию прячем ошибку
    document.getElementById('hoursError').classList.add('hidden');
  });
</script>
</body>
</html>
